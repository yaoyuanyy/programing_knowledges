= BeanFactoryPostProcessoryä¸BeanPostProcessoråŒºåˆ«
:toc-title: ç›®å½•
:tip-caption: ğŸ’¡
:note-caption: â„¹ï¸
:important-caption: â—
:caution-caption: ğŸ”¥
:warning-caption: âš ï¸
// :tip-caption: :bulb:
// :note-caption: :information_source:
// :important-caption: :heavy_exclamation_mark:	
// :caution-caption: :fire:
// :warning-caption: :warning:
:icons: font

Doc writer yaoyihao1@gmail.com

BeanFactoryPostProcessoryä¸BeanPostProcessoråœ¨springæ¡†æ¶ä¸­æ‰®æ¼”ç€å¾ˆé‡è¦çš„è§’è‰²ã€‚åªè¦ä½ debugæºç ï¼Œä½ éƒ½å¯ä»¥å‘ç°ä»–ä»¬çš„èº«å½±ã€‚åœ¨é¡¹ç›®å¯åŠ¨æ—¶ï¼ŒBeanFactoryPostProcessoryæ¯”BeanPostProcessorå…ˆå®ä¾‹åŒ–å’Œåˆå§‹åŒ–ã€‚é€šè¿‡ä»–ä»¬çš„å„ä¸ªç®€ä»‹ï¼Œæˆ‘ä»¬æ—¢èƒ½äº†è§£ä»–ä»¬è‡ªèº«ï¼Œä¹Ÿèƒ½å¤ŸæŒæ¡ä»–ä»¬çš„åŒºåˆ«æ‰€åœ¨


== BeanFactoryPostProcessoryç®€ä»‹
é¦–å…ˆçœ‹ä¸‹ç±»çš„javadoc 
<font size=1>
* Allows for custom modification of an application context's bean definitions, adapting the bean property values of the context's underlying bean factory.
* Application contexts can auto-detect BeanFactoryPostProcessor beans in their bean definitions and apply them before any other beans get created.
* Useful for custom config files targeted at system administrators that override bean properties configured in the application context.
* See PropertyResourceConfigurer and its concrete implementations for out-of-the-box solutions that address such configuration needs.
* A BeanFactoryPostProcessor may interact with and modify bean definitions, but never bean instances. Doing so may cause premature bean instantiation, violating the container and causing unintended side-effects. If bean instance interaction is required, consider implementing BeanPostProcessor instead

</font>

ç¿»è¯‘å¦‚ä¸‹ï¼š
<font size=1>
* å…è®¸application contextçš„bean definitionsè‡ªå®šä¹‰ä¿®æ”¹ï¼Œæ”¹å†™the contextçš„åº•å±‚bean factoryçš„beançš„å±æ€§å€¼ã€‚
* Application contextèƒ½é€šè¿‡ä»–çš„bean definitionsè‡ªåŠ¨æ£€æµ‹åˆ° BeanFactoryPostProcessor beansï¼Œå¹¶åœ¨å…¶ä»–çš„beansè¢«åˆ›å»ºå‰åº”ç”¨the beans
* è‡ªå®šä¹‰config fileså»è¦†ç›–application contexté…ç½®çš„beanå±æ€§æ˜¯æœ‰ç”¨çš„
* æŸ¥çœ‹PropertyResourceConfigurerç±»å’Œä»–çš„å…·ä½“çš„å®ç°ä¸ºè§£å†³é‚£äº›é…ç½®éœ€è¦çš„å³æ’å³ç”¨çš„æ–¹æ¡ˆ // todo æ²¡æ‡‚
* A BeanFactoryPostProcessorç”¨äºä¿®æ”¹bean definitionsï¼Œè€Œä¸æ˜¯bean instancesã€‚è¿™ä¹ˆåšå¯å¯¼è‡´beanè¿‡æ—©çš„ instantiation(å®ä¾‹åŒ–)ã€ä¾µçŠ¯å®¹å™¨å’Œå…¶ä»–æ„å¤–çš„å‰¯ä½œç”¨ã€‚å¦‚æœä½ è¦bean instanceï¼Œè¯·ä½¿ç”¨BeanPostProcessor

</font>

<font color="#FF0000">æ³¨</font>: æœ€åä¸€æ®µä¹Ÿæ˜¯<font color="green" size=3 face="å®‹ä½“"> *BeanFactoryPostProcessoryä¸BeanPostProcessoråŒºåˆ«*</font>


=== æ–¹æ³•
ä»–çš„æ–¹æ³•åªæœ‰ä¸€ä¸ªï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥åšåˆ°ï¼šbeanè¦†ç›–æˆ–æ·»åŠ å±æ€§ï¼Œç”šè‡³æ˜¯åˆå§‹åŒ–bean

----
/**
 * å…è®¸è¦†ç›–æˆ–æ·»åŠ å±æ€§ï¼Œç”šè‡³æ˜¯åˆå§‹åŒ–bean
 */
void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException;


----

== BeanPostProcessorç®€ä»‹
é¦–å…ˆçœ‹ä¸‹ç±»çš„javadoc 
<font size=1>
* Factory hook that allows for custom modification of new bean instances, e.g. checking for marker interfaces or wrapping them with proxies.
* ApplicationContexts can autodetect BeanPostProcessor beans in their bean definitions and apply them to any beans subsequently created. Plain bean factories allow for programmatic registration of post-processors, applying to all beans created through this factory
* Typically, post-processors that populate beans via marker interfaces or the like will implement postProcessBeforeInitialization(java.lang.Object, java.lang.String), while post-processors that wrap beans with proxies will normally implement postProcessAfterInitialization(java.lang.Object, java.lang.String)

</font>

ç¿»è¯‘å¦‚ä¸‹ï¼š
<font size=1>
* BeanPostProcessoræ˜¯ä¸€ä¸ª Factory hookï¼Œä»–å…è®¸è‡ªå®šä¹‰bean instancesçš„ä¿®æ”¹ï¼Œä¾‹å¦‚ï¼šæ£€æŸ¥marker interfaces æˆ–è€…wrapping them with proxies
* Application contextsèƒ½åœ¨ä»–ä»¬çš„bean definitionsä¸­è‡ªåŠ¨æ£€æŸ¥åˆ°BeanPostProcessror beansï¼Œå¹¶åœ¨éšååˆ›å»ºçš„ä»»ä½•beansä¸­åº”ç”¨ä»–ä»¬ã€‚æ™®é€šçš„bean factoryså…è®¸post-processorsçš„ç¨‹åºåŒ–æ³¨å†Œï¼Œé€šè¿‡this factoryåº”ç”¨åˆ°æ‰€æœ‰åˆ›å»ºçš„beans
* å…¸å‹çš„ï¼Œé€šè¿‡marker interfacesæˆ–è€…ç±»ä¼¼çš„äº§ç”Ÿbeansçš„post-processorså°†å®ç°postProcessBeforInitialization(Object,String)æ–¹æ³•ï¼Œè€Œé€šè¿‡porxiesåŒ…è£…beansçš„post-processorså°†å®ç°postProcessAfterInitialization(Object,String)æ–¹æ³•

</font>


=== æ–¹æ³•

----
å‰ç½®æ–¹æ³•
/**
 * Apply this BeanPostProcessor to the given new bean instance before any bean initialization callbacks (like InitializingBean's afterPropertiesSet or a custom init-method). 
 * The bean will already be populated with property values. The returned bean instance may be a wrapper around the original.
 */
Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException;



åç½®æ–¹æ³•
 * Apply this BeanPostProcessor to the given new bean instance after any bean initialization callbacks (like InitializingBean's afterPropertiesSet or a custom init-method). The bean will already be populated with property values. The returned bean instance may be a wrapper around the original.
 * In case of a FactoryBean, this callback will be invoked for both the FactoryBean instance and the objects created by the FactoryBean (as of Spring 2.0). The post-processor can decide whether to apply to either the FactoryBean or created objects or both through corresponding bean instanceof FactoryBean checks.
 * This callback will also be invoked after a short-circuiting triggered by a InstantiationAwareBeanPostProcessor.postProcessBeforeInstantiation(java.lang.Class<?>, java.lang.String) method, in contrast to all other BeanPostProcessor callbacks
 */
Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException;


----


== æ€»ç»“ï¼š
- <font color="green">*BeanFactoryPostProcessorè´Ÿè´£å¤„ç†bean definitions. è€ŒBeanPostProcessorè´Ÿè´£å¤„ç†bean instances*</font>
- ç”±äºbean definitionå…ˆä¸bean instanceï¼Œæ‰€ä»¥spring æ¡†æ¶å…ˆåº”ç”¨BeanFactoryPostProcessorï¼Œä¹‹åå†åº”ç”¨BeanPostProcessor
- é€šä¿—çš„è¯è®²ï¼Œåœ¨bean instanceä¹‹å‰ï¼Œä½ å¯ä»¥ä½¿ç”¨BeanFactoryPostProcessoræ“ä½œbean definitonsæ¥ç¼–è¾‘bean(è¦†ç›–æˆ–å±æ€§èµ‹å€¼ç­‰)ï¼Œç„¶åBeanPostProcessorè¿›è¡Œbean instanceæ“ä½œ


ä»¥ä¸‹ä»stackoverflowè·å–

== The differences about BeanFactoryPostProcessor and BeanPostProcessor:
* A bean implementing BeanFactoryPostProcessor is called when all bean definitions will have been loaded, but no beans will have been instantiated yet. This allows for overriding or adding properties even to eager-initializing beans. This will let you have access to all the beans that you have defined in XML or that are annotated (scanned via component-scan).
* A bean implementing BeanPostProcessor operate on bean (or object) instances which means that when the Spring IoC container instantiates a bean instance then BeanPostProcessor interfaces do their work.
* BeanFactoryPostProcessor implementations are "called" during startup of the Spring context after all bean definitions will have been loaded while BeanPostProcessor are "called" when the Spring IoC container instantiates a bean (i.e. during the startup for all the singleton and on demand for the proptotypes one)


== é—®é¢˜
1. bean definition ä¸bean instanceåœ¨å“ªä¸ªåœ°æ–¹æœ‰è”ç³»çš„ã€‚å³bean definitionä»€ä¹ˆæ—¶å€™åœ¨å“ªé‡Œè½¬åŒ–æˆbean instanceçš„
2. BeanFactoryPostProcessorå’ŒBeanPostProcessorè¢«Applicatioin contextè‡ªåŠ¨æ£€æµ‹åˆ°æ˜¯å¦‚ä½•å®ç°çš„


== é¢˜å¤– 

=== BeanFactoryPostProcessorä¸BeanDefinitionRegistryPostProcessorçš„åŒºåˆ«,è§ï¼Ÿï¼Ÿ